name: Feishu Project Monitor

on:
  # ç›‘å¬ä»£ç æäº¤
  push:
    branches: [ "main", "master" ]
  # ç›‘å¬ Issue å˜åŠ¨
  issues:
    types: [opened, closed, reopened]

jobs:
  notify-workflow:
    runs-on: ubuntu-latest
    # è®¾ç½®æƒé™ï¼Œç¡®ä¿å¯ä»¥è¯»å–ä»“åº“ä¿¡æ¯
    permissions:
      contents: read
      issues: read

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # --- 1. æ¨¡æ‹Ÿæ„å»º/æµ‹è¯•é˜¶æ®µ (å¦‚æœæ˜¯ Unity é¡¹ç›®ï¼Œå¯ä»¥æ›¿æ¢ä¸ºä½ çš„æµ‹è¯•æ­¥éª¤) ---
      - name: Run Build/Test Scripts
        if: github.event_name == 'push'
        run: |
          echo "æ­£åœ¨æ‰§è¡Œä»»åŠ¡..."
          sleep 2
          echo "æ‰§è¡Œå®Œæˆ"

      # --- 2. é£ä¹¦é€šçŸ¥æ­¥éª¤ (å…³é”®ä¿®å¤ï¼šç¡®ä¿ç¼©è¿›åœ¨ steps ä¹‹ä¸‹) ---
      - name: Notify Build Status
        if: always() && github.event_name == 'push'
        uses: foxundermoon/feishu-action@v2
        with:
          url: ${{ secrets.FEISHU_BOT_WEBHOOK_URL }}
          msg_type: post
          content: |
            post:
              zh_cn:
                title: "é¡¹ç›®æ„å»ºç»“æœ: ${{ job.status == 'success' && 'âœ… æˆåŠŸ' || 'âŒ å¤±è´¥' }}"
                content:
                  - - tag: text
                      text: "ğŸ“¦ ä»“åº“: "
                    - tag: text
                      text: "${{ github.repository }}"
                  - - tag: text
                      text: "\nğŸ”¨ åˆ†æ”¯: "
                    - tag: text
                      text: "${{ github.ref_name }}"
                  - - tag: text
                      text: "\nğŸ‘¤ æäº¤äºº: "
                    - tag: text
                      text: "${{ github.actor }}"
                  - - tag: text
                      text: "\nğŸ“ æäº¤ä¿¡æ¯: "
                    - tag: text
                      text: "${{ github.event.head_commit.message }}"
                  - - tag: text
                      text: "\n"
                  - - tag: a
                      text: "ğŸ‘‰ æŸ¥çœ‹æ„å»ºè¯¦æƒ…"
                      href: "https://github.com/${{ github.repository_actions/runs/${{ github.run_id }}"

      # --- 3. Issue åŠ¨æ€é€šçŸ¥ ---
      - name: Notify Issue Update
        if: github.event_name == 'issues'
        uses: foxundermoon/feishu-action@v2
        with:
          url: ${{ secrets.FEISHU_BOT_WEBHOOK_URL }}
          msg_type: post
          content: |
            post:
              zh_cn:
                title: ğŸ§© Issue åŠ¨æ€æé†’
                content:
                  - - tag: text
                      text: "Action: "
                    - tag: text
                      text: "${{ github.event.action }}"
                  - - tag: text
                      text: "\nğŸ“Œ æ ‡é¢˜: "
                    - tag: text
                      text: "${{ github.event.issue.title }}"
                  - - tag: a
                      text: "\nğŸ‘‰ ç‚¹å‡»æŸ¥çœ‹ Issue"
                      href: "${{ github.event.issue.html_url }}"